@model List<HospitalManagement.Models.Patient>
@{
    ViewBag.Title = "Patient";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="form-group">    
    <h2>Patient List</h2>    
</div>

<table id="tblPatient" class="table table-bordered table-hover">
    <thead>
        <tr>
            <th>Serial No.</th>
            <th>Patient Name</th>
            <th>Disease</th>
            <th>Date Of Birth</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody>
        @*@if (Model.Count == 0)
        {
        <tr><td colspan="4">No Data to Show</td></tr>
        }
        else
        {
        foreach (var item in Model)
        {
            <tr>
                <td>@item.PatientId</td>
                <td>
                    @Html.ActionLink(item.PatientName,"Edit","Patient",new { @id=item.PatientId},null)
                </td>
                <td>@item.Dieseases</td>
                <td>@item.DateOfBirth.Value.Date.ToShortDateString()</td>
                <td>
                    <button data-patient-id="@item.PatientId" class="btn-link js-delete">Delete</button>
                </td>
            </tr>
        }
        }*@        
    </tbody>
</table>

@Html.ActionLink("New Patient", "New", "Patient", new { @class = "btn btn-primary" })
@section Scripts{
<script>
    $(document).ready(function () {
        
        var table = $("#tblPatient").DataTable({
            ajax: {
                url:"/api/patients",
                dataSrc:""
            },
            columns: [
                {
                    data: "PatientId"
                },
                {
                data:"Name",
                render: function (data,type, patient) {
                    return "<a href='/Appointment/Details/" + patient.PatientId + "'>" + patient.PatientName + "</a>";
                }
            },
            {
                data: "Dieseases"               
            },
            {
                data: "DateOfBirth",
                render: function (data) {
                    var date = new Date(data);
                    var month = date.getMonth() + 1;
                    return (month.toString().length > 1 ? month : "0" + month) + "/" + date.getDate() + "/" + date.getFullYear();
                }
            },
            {
                data: "PatientId",
                render: function (data) {
                    return "<a class='btn btn-primary' href='/Patient/Edit/"+data+"'>Edit</a>  <button class='btn btn-primary js-delete' data-patient-id=" + data + ">Delete</button>";
                }
            }
            ]
        });

        $("#tblPatient").on("click", ".js-edit", function () {
            var button = $(this);                
                    $.ajax({
                        url: "/api/patients/" + button.attr("data-patient-id"),
                        method: "PUT",
                        success: function () {
                            table.row(button.parents("tr")).remove().draw();
                        }
                    });
        })

        $("#tblPatient").on("click", ".js-delete", function () {
            var button = $(this);
            bootbox.confirm("Are you sure to delete this patient?", function (result) {
                if (result) {
                    $.ajax({
                        url: "/api/patients/" + button.attr("data-patient-id"),
                        method: "DELETE",
                        success: function () {
                            table.row(button.parents("tr")).remove().draw();
                        }
                    });
                }
            });            
        })
    });
</script>
    }
